<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>Embedding Maruku in Movable Type</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="author" content="Your Name" />
    <link href="../default.css" rel="stylesheet" type="text/css" />
    <link href="../style.css" rel="stylesheet" type="text/css" />
    <link href="../css/webgen.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="header">
    </div>

<!--    <div id="headerbar" class="bar">
      <span class="left">Location: <a href="../index.html"></a> / <a href="index.html">Embedding</a> / <span>Movable Type</span></span>
      <span class="right">Language: <span>en</span></span>
      <div style="clear:both"></div>
    </div>
-->

    <div id="menu">
	<!--	<img src="logo.png"/><br/>-->
      <a href="../index.html">Maruku</a> <br/>

      <div class="webgen-menu-vert webgen-menu"><ul><li ><a href="../maruku.html">Features</a></li><li class="webgen-menu-submenu webgen-menu-submenu-inhierarchy"><a href="index.html">Embedding</a><ul><li ><a href="radiant.html">Radiant</a></li></ul></li><li ><a href="../index.html">Home</a></li><li ><a href="../usage.html">Usage</a></li></ul></div>
	<br/>
	<!-- <img style="float:right" width="7em" src="logo.png"/> -->

	<p style="text-align: center; margin-top: 4em">
      <a href="http://webgen.rubyforge.org"><img src="../images/webgen-generated-by.png" alt="Generated by webgen"/></a>
</p>

    </div>

    <div id="body">
		<h1 style="color: red">Embedding Maruku in Movable Type</h1>

      <p>I hacked this plugin for <a href='http://movabletype.org'>Movable Type</a>. I hope someone will improve on it. Please note that I don&#8217;t know Perl.</p>

<pre lang='perl'><code class='perl' lang='perl'>package MT::Plugins::Maruku;
use vars qw( $MARUKU );

# Put here the path to the Maruku executable.
$MARUKU = &quot;/usr/bin/maruku&quot;;

use MT;

MT-&gt;add_text_filter(&#39;Maruku&#39; =&gt; {
  label =&gt; &#39;Maruku&#39;,
  docs =&gt; &#39;http://maruku.rubyforge.org&#39;,
  on_format =&gt; \&amp;maruku
});

sub maruku {
	use File::Temp qw/ tempfile tempdir /;
	my $text=shift;
	my $ctx=shift;

	($fh, $filename) = tempfile();
	print $fh  $text;
	close $fh ;

	$fileout = $filename.&quot;.out&quot;; 

	@args = (
		$MARUKU, 
		&quot;--html-frag&quot;, 
		&quot;-m&quot;, &quot;blahtex&quot;,
		&quot;-o&quot;, $fileout,
		$filename);
    system(@args) == 0
	 or die &quot;system @args failed: $?&quot;;

	# read entire file
	$result  = &quot;&quot;;
	open SLURP, $fileout or die &quot;can&#39;t open  $fileout: $!&quot;;
	while ($data = &lt;SLURP&gt;) {
		$result = $result . $data;
	}
	close SLURP or die &quot;cannot close  $fileout: $!&quot;;


	$result;
}</code></pre>
    </div>


	<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
	</script>
	<script type="text/javascript">
	_uacct = "UA-155626-2";
	urchinTracker();
	</script>

  </body>
</html>