<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head>
    <title>Extending Maruku</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="author" content="Your Name" />
    <link href="../default.css" rel="stylesheet" type="text/css" />
    <link href="../style.css" rel="stylesheet" type="text/css" />
    <link href="../css/webgen.css" rel="stylesheet" type="text/css" />
  </head>
  <body>
    <div id="header">
    </div>

<!--    <div id="headerbar" class="bar">
      <span class="left">Location: <a href="../index.html"></a> / <a href="./">Extending</a> / <span>Extending</span></span>
      <span class="right">Language: <span>en</span></span>
      <div style="clear:both"></div>
    </div>
-->

    <div id="menu">
	<!--	<img src="logo.png"/><br/>-->
      <a href="../index.html">Maruku</a> <br/>

      <div class="webgen-menu-vert webgen-menu"><ul><li ><a href="../maruku.html">Features</a></li><li class="webgen-menu-submenu"><a href="../embedding/index.html">Embedding</a></li><li ><a href="../index.html">Home</a></li><li ><a href="../usage.html">Usage</a></li></ul></div>
	<br/>
	<!-- <img style="float:right" width="7em" src="logo.png"/> -->

	<p style="text-align: center; margin-top: 4em">
      <a href="http://webgen.rubyforge.org"><img src="../images/webgen-generated-by.png" alt="Generated by webgen"/></a>
</p>

    </div>

    <div id="body">
		<h1 style="color: red">Extending Maruku</h1>

      <p><strong><em>INCOMPLETE DRAFT</em></strong></p>

<p>The syntax used by Maruku can be extended with other constructs. Currently, this is used in practice to support math equations and the div syntax. This is a miniguide for using the extensions mechanisms.</p>

<h2 id='introduction_parsing_process_and_internal_representations'>Introduction: parsing process and internal representations</h2>

<h2 id='extending_blocklevel_constructs'>Extending block-level constructs</h2>

<p>The syntax for registering your new block-level construct is:</p>

<pre><code class='ruby' lang='ruby'><span class='constant'>MaRuKu</span><span class='punct'>::</span><span class='constant'>In</span><span class='punct'>::</span><span class='constant'>Markdown</span><span class='punct'>::</span><span class='ident'>register_block_extension</span><span class='punct'>(</span>
	<span class='symbol'>:regexp</span>  <span class='punct'>=&gt;</span> <span class='ident'>your_regexp</span><span class='punct'>,</span>
	<span class='symbol'>:handler</span> <span class='punct'>=&gt;</span> <span class='ident'>lambda</span> <span class='punct'>{</span> <span class='punct'>|</span><span class='ident'>doc</span><span class='punct'>,</span> <span class='ident'>src</span><span class='punct'>,</span> <span class='ident'>context</span><span class='punct'>|</span>
		<span class='comment'># doc     is the Document handle</span>
		<span class='comment'># src     is the LineSource handle</span>
		<span class='comment'># context is the array of previously read elements</span>
		<span class='punct'>...</span>
		<span class='comment'># return true if you are handling this, false otherwise</span>
	<span class='punct'>}</span>
<span class='punct'>)</span></code></pre>

<p>For example, say that you want to recognize the DIV syntax:</p>

<pre><code>+--
Div content
=--</code></pre>

<p>In this example, for brevity, we don&#8217;t care about the full syntax for DIVs. The resulting code is compact and easy to understand:</p>

<pre><code class='ruby' lang='ruby'><span class='constant'>OpenDiv</span> <span class='punct'>=</span> <span class='punct'>/</span><span class='regex'>^<span class='escape'>\+\-\-</span></span><span class='punct'>/</span>
<span class='constant'>CloseDiv</span> <span class='punct'>=</span> <span class='punct'>/</span><span class='regex'>^<span class='escape'>\=\-\-</span></span><span class='punct'>/</span>

<span class='constant'>MaRuKu</span><span class='punct'>::</span><span class='constant'>In</span><span class='punct'>::</span><span class='constant'>Markdown</span><span class='punct'>::</span><span class='ident'>register_block_extension</span><span class='punct'>(</span>
	<span class='symbol'>:regexp</span>  <span class='punct'>=&gt;</span> <span class='constant'>OpenDiv</span><span class='punct'>,</span>
	<span class='symbol'>:handler</span> <span class='punct'>=&gt;</span> <span class='ident'>lambda</span> <span class='punct'>{</span> <span class='punct'>|</span><span class='ident'>doc</span><span class='punct'>,</span> <span class='ident'>src</span><span class='punct'>,</span> <span class='ident'>context</span><span class='punct'>|</span>
		<span class='comment'># Throw away the first line.</span>
		<span class='ident'>src</span><span class='punct'>.</span><span class='ident'>shift_line</span>
		<span class='comment'># Read lines from src until one matches CloseDiv</span>
		<span class='ident'>lines</span> <span class='punct'>=</span> <span class='punct'>[]</span>
		<span class='keyword'>while</span> <span class='ident'>src</span><span class='punct'>.</span><span class='ident'>cur_line</span> <span class='punct'>&amp;&amp;</span> <span class='punct'>!(</span><span class='ident'>src</span><span class='punct'>.</span><span class='ident'>cur_line</span> <span class='punct'>=~</span> <span class='constant'>CloseDiv</span><span class='punct'>)</span>
			<span class='ident'>lines</span><span class='punct'>.</span><span class='ident'>push</span> <span class='ident'>src</span><span class='punct'>.</span><span class='ident'>shift_line</span>
		<span class='keyword'>end</span>
		<span class='comment'># Throw away this last line.</span>
		<span class='ident'>src</span><span class='punct'>.</span><span class='ident'>shift_line</span>
		<span class='comment'># Parse lines as blocks.</span>
		<span class='ident'>content</span> <span class='punct'>=</span> <span class='ident'>doc</span><span class='punct'>.</span><span class='ident'>parse_blocks</span><span class='punct'>(</span><span class='constant'>LineSource</span><span class='punct'>.</span><span class='ident'>new</span><span class='punct'>(</span><span class='ident'>lines</span><span class='punct'>))</span>
		<span class='comment'># Push into context a div element with such content.</span>
		<span class='ident'>context</span><span class='punct'>.</span><span class='ident'>push</span> <span class='ident'>doc</span><span class='punct'>.</span><span class='ident'>md_div</span><span class='punct'>(</span><span class='ident'>content</span><span class='punct'>)</span>
		<span class='constant'>true</span>
	<span class='punct'>})</span></code></pre>

<h2 id='extending_spanlevel_constructs'>Extending span-level constructs</h2>
    </div>


	<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
	</script>
	<script type="text/javascript">
	_uacct = "UA-155626-2";
	urchinTracker();
	</script>

  </body>
</html>