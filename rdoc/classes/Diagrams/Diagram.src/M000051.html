<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>find_arrow (Diagrams::Diagram)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File lib/maruku/ext/diagrams/parser.rb, line 61</span>
        <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_arrow</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-identifier">reg</span>, <span class="ruby-identifier">cap1</span>, <span class="ruby-identifier">cap2</span>, <span class="ruby-identifier">inc_x</span>, <span class="ruby-identifier">inc_y</span>)
                <span class="ruby-identifier">inc</span> = [<span class="ruby-identifier">inc_x</span>, <span class="ruby-identifier">inc_y</span>]
                <span class="ruby-identifier">rinc</span> = [<span class="ruby-operator">-</span><span class="ruby-identifier">inc_x</span>, <span class="ruby-operator">-</span><span class="ruby-identifier">inc_y</span>]
                
                <span class="ruby-identifier">a</span> = <span class="ruby-constant">Arrow</span>.<span class="ruby-identifier">new</span>
                
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cap1</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">c</span> = <span class="ruby-ivar">@text</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">x</span><span class="ruby-operator">-</span><span class="ruby-identifier">inc_x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">-</span><span class="ruby-identifier">inc_y</span>))
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">cap1</span> = <span class="ruby-identifier">c</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_pos</span> = [<span class="ruby-identifier">x</span><span class="ruby-operator">-</span><span class="ruby-identifier">inc_x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">-</span><span class="ruby-identifier">inc_y</span>]
                <span class="ruby-keyword kw">else</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">cap1</span> = <span class="ruby-keyword kw">nil</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_pos</span> = [<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>]
                <span class="ruby-keyword kw">end</span>
                
                <span class="ruby-identifier">s</span> = <span class="ruby-identifier">match</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>,<span class="ruby-identifier">reg</span>,<span class="ruby-identifier">inc_x</span>,<span class="ruby-identifier">inc_y</span>)
                <span class="ruby-identifier">len</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">size</span>
                
                <span class="ruby-identifier">a</span>.<span class="ruby-identifier">end_pos</span> = [<span class="ruby-identifier">x</span><span class="ruby-operator">+</span>(<span class="ruby-identifier">len</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)<span class="ruby-operator">*</span><span class="ruby-identifier">inc_x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">+</span>(<span class="ruby-identifier">len</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)<span class="ruby-operator">*</span><span class="ruby-identifier">inc_y</span>]
                <span class="ruby-identifier">maybe_cap</span> = [<span class="ruby-identifier">x</span><span class="ruby-operator">+</span>(<span class="ruby-identifier">len</span>)<span class="ruby-operator">*</span><span class="ruby-identifier">inc_x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">+</span>(<span class="ruby-identifier">len</span>)<span class="ruby-operator">*</span><span class="ruby-identifier">inc_y</span>]
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cap2</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">c</span>=<span class="ruby-ivar">@text</span>.<span class="ruby-identifier">get</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">maybe_cap</span>))
                        <span class="ruby-identifier">len</span> <span class="ruby-operator">+=</span><span class="ruby-value">1</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">end_pos</span> = <span class="ruby-identifier">maybe_cap</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">cap2</span> = <span class="ruby-identifier">c</span>   
                <span class="ruby-keyword kw">else</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">cap2</span> = <span class="ruby-keyword kw">nil</span>
                <span class="ruby-keyword kw">end</span>
                
                <span class="ruby-identifier">a</span>.<span class="ruby-identifier">length</span> = <span class="ruby-identifier">len</span>
                
                <span class="ruby-identifier">before</span> = [<span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_pos</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">inc_x</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_pos</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">-</span><span class="ruby-identifier">inc_y</span>]
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ob</span> = <span class="ruby-ivar">@occup</span>.<span class="ruby-identifier">get</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">before</span>)
                        <span class="ruby-identifier">impact</span> = <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">link_direction</span>(<span class="ruby-identifier">before</span>, <span class="ruby-identifier">rinc</span>)
                        <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">links</span>[<span class="ruby-identifier">impact</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">a</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">links</span>[<span class="ruby-constant">Reverse</span>[<span class="ruby-identifier">impact</span>]]<span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ob</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_link</span> = <span class="ruby-identifier">ob</span>
                <span class="ruby-keyword kw">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Nothing found at #{before.inspect} : #{
                        @text.get(*before)
                        } while #{@text.get(*a.start_pos).chr}&quot;</span>
                <span class="ruby-keyword kw">end</span>
                <span class="ruby-identifier">after</span> = [<span class="ruby-identifier">a</span>.<span class="ruby-identifier">end_pos</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">inc_x</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">end_pos</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-identifier">inc_y</span>]
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ob</span> = <span class="ruby-ivar">@occup</span>.<span class="ruby-identifier">get</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">after</span>)
                        <span class="ruby-identifier">impact</span> = <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">link_direction</span>(<span class="ruby-identifier">after</span>, <span class="ruby-identifier">inc</span>)
                        <span class="ruby-identifier">ob</span>.<span class="ruby-identifier">links</span>[<span class="ruby-identifier">impact</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">a</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">links</span>[<span class="ruby-constant">Reverse</span>[<span class="ruby-identifier">impact</span>]] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ob</span>
                        <span class="ruby-identifier">a</span>.<span class="ruby-identifier">end_link</span> = <span class="ruby-identifier">ob</span>
                <span class="ruby-keyword kw">else</span>
                        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Nothing found at #{after.inspect} : #{
                        @text.get(*after)
                        } while #{@text.get(*a.end_pos).chr}&quot;</span>
                <span class="ruby-keyword kw">end</span>
                
                <span class="ruby-identifier">iterate</span>(<span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_pos</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">end_pos</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
                        <span class="ruby-ivar">@to_process</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>,<span class="ruby-keyword kw">false</span>)
                        <span class="ruby-ivar">@occup</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">x</span>,<span class="ruby-identifier">y</span>,<span class="ruby-identifier">a</span>)
                <span class="ruby-keyword kw">end</span>
                
                <span class="ruby-ivar">@arrows</span>.<span class="ruby-identifier">push</span> <span class="ruby-identifier">a</span>
                <span class="ruby-identifier">p</span> <span class="ruby-identifier">a</span>
        <span class="ruby-keyword kw">end</span></pre>
</body>
</html>